<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Workout Receiver</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    #screen-title {
      margin: 20px 0;
      font-size: 2em;
    }
    #workout-content {
      margin: 20px auto;
      max-width: 600px;
      font-size: 1.2em;
    }
    .exercise {
      margin-bottom: 16px;
    }
    .exercise h2 {
      margin: 0 0 8px;
      font-size: 1.5em;
    }
  </style>

  <!-- 1) CAF v3 Receiver SDK -->
  <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
</head>
<body>
  <div id="screen-title">Waiting for workout…</div>
  <div id="workout-content"></div>

  <script>
    // 2) Get the CAF ReceiverContext singleton
    const context = cast.framework.CastReceiverContext.getInstance();
context.setLoggerLevel(cast.framework.LoggerLevel.DEBUG);

    // 3) (Optional) More verbose logs in chrome://inspect → Remote Target

    // 4) Listen for custom messages on your namespace
    const NAMESPACE = 'urn:x-cast:workout.channel';
    context.addCustomMessageListener(NAMESPACE, (event) => {
      const msg = event.data;
      console.log('⚡ Receiver got message:', msg);

      // If sender says to change the screen
      if (msg.type === 'screen' && msg.screen) {
        document.getElementById('screen-title').textContent = msg.screen;
        document.getElementById('workout-content').innerHTML = '';
      }

      // If sender sends an exercise payload
      else if (msg.type === 'exercise' && msg.payload) {
        const { name, reps, duration } = msg.payload;
        document.getElementById('workout-content').innerHTML = `
          <div class="exercise">
            <h2>${name || 'Exercise'}</h2>
            ${reps  != null ? `<p>Reps: ${reps}</p>` : ''}
            ${duration ? `<p>Duration: ${duration}</p>` : ''}
          </div>`;
      }

      // Handle command messages like start, pause, reset
      else if (msg.type === 'command') {
        switch (msg.action) {
          case 'start':
            startWorkout();
            break;
          case 'pause':
            pauseWorkout();
            break;
          case 'reset':
            resetWorkout();
            break;
        }
      }
    });

    // 5) Start the receiver: opens the WebSocket & binds handlers
    
    function startWorkout() {
      const title = document.getElementById('screen-title');
      title.textContent = '[▶] Workout Started';
      // You could also trigger a countdown or audio here
    }

    function pauseWorkout() {
      const title = document.getElementById('screen-title');
      title.textContent = '[⏸] Workout Paused';
    }

    function resetWorkout() {
      const title = document.getElementById('screen-title');
      title.textContent = 'Waiting for workout…';
      document.getElementById('workout-content').innerHTML = '';
    }

    context.start();
  </script>
</body>
</html>
